var G="data-focus-lock",fr="data-focus-lock-disabled",cr="data-no-focus-lock",vr="data-autofocus-inside",dr="data-no-autofocus";var b=function(r){for(var n=Array(r.length),e=0;e<r.length;++e)n[e]=r[e];return n},x=function(r){return Array.isArray(r)?r:[r]},J=function(r){return Array.isArray(r)?r[0]:r},lr=function(r){if(r.nodeType!==Node.ELEMENT_NODE)return!1;var n=window.getComputedStyle(r,null);return!n||!n.getPropertyValue?!1:n.getPropertyValue("display")==="none"||n.getPropertyValue("visibility")==="hidden"},Q=function(r){return r.parentNode&&r.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?r.parentNode.host:r.parentNode},X=function(r){return r===document||r&&r.nodeType===Node.DOCUMENT_NODE},sr=function(r){return r.hasAttribute("inert")},br=function(r,n){return!r||X(r)||!lr(r)&&!sr(r)&&n(Q(r))},Z=function(r,n){var e=r.get(n);if(e!==void 0)return e;var t=br(n,Z.bind(void 0,r));return r.set(n,t),t},mr=function(r,n){return r&&!X(r)?Or(r)?n(Q(r)):!1:!0},$=function(r,n){var e=r.get(n);if(e!==void 0)return e;var t=mr(n,$.bind(void 0,r));return r.set(n,t),t},rr=function(r){return r.dataset},gr=function(r){return r.tagName==="BUTTON"},nr=function(r){return r.tagName==="INPUT"},er=function(r){return nr(r)&&r.type==="radio"},hr=function(r){return!((nr(r)||gr(r))&&(r.type==="hidden"||r.disabled))},Or=function(r){var n=r.getAttribute(dr);return![!0,"true",""].includes(n)},C=function(r){var n;return!!(r&&(!((n=rr(r))===null||n===void 0)&&n.focusGuard))},M=function(r){return!C(r)},xr=function(r){return!!r},yr=function(r,n){var e=Math.max(0,r.tabIndex),t=Math.max(0,n.tabIndex),a=e-t,u=r.index-n.index;if(a){if(!e)return 1;if(!t)return-1}return a||u},pr=function(r){return r.tabIndex<0&&!r.hasAttribute("tabindex")?0:r.tabIndex},P=function(r,n,e){return b(r).map(function(t,a){var u=pr(t);return{node:t,index:a,tabIndex:e&&u===-1?(t.dataset||{}).focusGuard?0:-1:u}}).filter(function(t){return!n||t.tabIndex>=0}).sort(yr)},Fr=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],k=Fr.join(","),Ir="".concat(k,", [data-focus-guard]"),tr=function(r,n){return b((r.shadowRoot||r).children).reduce(function(e,t){return e.concat(t.matches(n?Ir:k)?[t]:[],tr(t))},[])},Ar=function(r,n){var e;return r instanceof HTMLIFrameElement&&(!((e=r.contentDocument)===null||e===void 0)&&e.body)?p([r.contentDocument.body],n):[r]},p=function(r,n){return r.reduce(function(e,t){var a,u=tr(t,n),o=(a=[]).concat.apply(a,u.map(function(c){return Ar(c,n)}));return e.concat(o,t.parentNode?b(t.parentNode.querySelectorAll(k)).filter(function(c){return c===t}):[])},[])},wr=function(r){var n=r.querySelectorAll("[".concat(vr,"]"));return b(n).map(function(e){return p([e])}).reduce(function(e,t){return e.concat(t)},[])},U=function(r,n){return b(r).filter(function(e){return Z(n,e)}).filter(function(e){return hr(e)})},j=function(r,n){return n===void 0&&(n=new Map),b(r).filter(function(e){return $(n,e)})},R=function(r,n,e){return P(U(p(r,e),n),!0,e)},w=function(r,n){return P(U(p(r),n),!1)},Er=function(r,n){return U(wr(r),n)},O=function(r,n){return r.shadowRoot?O(r.shadowRoot,n):Object.getPrototypeOf(r).contains!==void 0&&Object.getPrototypeOf(r).contains.call(r,n)?!0:b(r.children).some(function(e){var t;if(e instanceof HTMLIFrameElement){var a=(t=e.contentDocument)===null||t===void 0?void 0:t.body;return a?O(a,n):!1}return O(e,n)})},Tr=function(r){for(var n=new Set,e=r.length,t=0;t<e;t+=1)for(var a=t+1;a<e;a+=1){var u=r[t].compareDocumentPosition(r[a]);(u&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&n.add(a),(u&Node.DOCUMENT_POSITION_CONTAINS)>0&&n.add(t)}return r.filter(function(o,c){return!n.has(c)})},ar=function(r){return r.parentNode?ar(r.parentNode):r},W=function(r){var n=x(r);return n.filter(Boolean).reduce(function(e,t){var a=t.getAttribute(G);return e.push.apply(e,a?Tr(b(ar(t).querySelectorAll("[".concat(G,'="').concat(a,'"]:not([').concat(fr,'="disabled"])')))):[t]),e},[])},Sr=function(r){try{return r()}catch{return}},A=function(r){if(r===void 0&&(r=document),!(!r||!r.activeElement)){var n=r.activeElement;return n.shadowRoot?A(n.shadowRoot):n instanceof HTMLIFrameElement&&Sr(function(){return n.contentWindow.document})?A(n.contentWindow.document):n}},Nr=function(r,n){return r===n},Mr=function(r,n){return!!b(r.querySelectorAll("iframe")).some(function(e){return Nr(e,n)})},qr=function(r,n){return n===void 0&&(n=A(J(r).ownerDocument)),!n||n.dataset&&n.dataset.focusGuard?!1:W(r).some(function(e){return O(e,n)||Mr(e,n)})},Gr=function(r){r===void 0&&(r=document);var n=A(r);return n?b(r.querySelectorAll("[".concat(cr,"]"))).some(function(e){return O(e,n)}):!1},_r=function(r,n){return n.filter(er).filter(function(e){return e.name===r.name}).filter(function(e){return e.checked})[0]||r},B=function(r,n){return er(r)&&r.name?_r(r,n):r},Dr=function(r){var n=new Set;return r.forEach(function(e){return n.add(B(e,r))}),r.filter(function(e){return n.has(e)})},V=function(r){return r[0]&&r.length>1?B(r[0],r):r[0]},z=function(r,n){return r.indexOf(B(n,r))},_="NEW_FOCUS",Cr=function(r,n,e,t,a){var u=r.length,o=r[0],c=r[u-1],m=C(t);if(!(t&&r.indexOf(t)>=0)){var i=t!==void 0?e.indexOf(t):-1,h=a?e.indexOf(a):i,f=a?r.indexOf(a):-1;if(i===-1)return f!==-1?f:_;if(f===-1)return _;var v=i-h,s=e.indexOf(o),l=e.indexOf(c),d=Dr(e),E=t!==void 0?d.indexOf(t):-1,F=E-(a?d.indexOf(a):i);if(!v&&f>=0||n.length===0)return f;var g=z(r,n[0]),y=z(r,n[n.length-1]);if(i<=s&&m&&Math.abs(v)>1)return y;if(i>=l&&m&&Math.abs(v)>1)return g;if(v&&Math.abs(F)>1)return f;if(i<=s)return y;if(i>l)return g;if(v)return Math.abs(v)>1?f:(u+f+v)%u}},Pr=function(r){return function(n){var e,t=(e=rr(n))===null||e===void 0?void 0:e.autofocus;return n.autofocus||t!==void 0&&t!=="false"||r.indexOf(n)>=0}},K=function(r,n,e){var t=r.map(function(u){var o=u.node;return o}),a=j(t.filter(Pr(e)));return a&&a.length?V(a):V(j(n))},D=function(r,n){return n===void 0&&(n=[]),n.push(r),r.parentNode&&D(r.parentNode.host||r.parentNode,n),n},T=function(r,n){for(var e=D(r),t=D(n),a=0;a<e.length;a+=1){var u=e[a];if(t.indexOf(u)>=0)return u}return!1},ur=function(r,n,e){var t=x(r),a=x(n),u=t[0],o=!1;return a.filter(Boolean).forEach(function(c){o=T(o||c,c)||o,e.filter(Boolean).forEach(function(m){var i=T(u,m);i&&(!o||O(i,o)?o=i:o=T(i,o))})}),o},Y=function(r,n){return r.reduce(function(e,t){return e.concat(Er(t,n))},[])},kr=function(r,n){var e=new Map;return n.forEach(function(t){return e.set(t.node,t)}),r.map(function(t){return e.get(t)}).filter(xr)},Ur=function(r,n){var e=A(x(r).length>0?document:J(r).ownerDocument),t=W(r).filter(M),a=ur(e||r,r,t),u=new Map,o=w(t,u),c=o.filter(function(l){var d=l.node;return M(d)});if(c[0]){var m=w([a],u).map(function(l){var d=l.node;return d}),i=kr(m,c),h=i.map(function(l){var d=l.node;return d}),f=i.filter(function(l){var d=l.tabIndex;return d>=0}).map(function(l){var d=l.node;return d}),v=Cr(h,f,m,e,n);if(v===_){var s=K(o,f,Y(t,u))||K(o,h,Y(t,u));if(s)return{node:s};console.warn("focus-lock: cannot find any node to move focus into");return}return v===void 0?v:i[v]}},jr=function(r){var n=W(r).filter(M),e=ur(r,r,n),t=P(p([e],!0),!0,!0),a=p(n,!1);return t.map(function(u){var o=u.node,c=u.index;return{node:o,index:c,lockItem:a.indexOf(o)>=0,guard:C(o)}})},L=function(r,n){r&&("focus"in r&&r.focus(n),"contentWindow"in r&&r.contentWindow&&r.contentWindow.focus())},S=0,N=!1,Vr=function(r,n,e){e===void 0&&(e={});var t=Ur(r,n);if(!N&&t){if(S>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),N=!0,setTimeout(function(){N=!1},1);return}S++,L(t.node,e.focusOptions),S--}};function I(r){if(!r)return null;if(typeof WeakRef>"u")return function(){return r||null};var n=r?new WeakRef(r):null;return function(){return(n==null?void 0:n.deref())||null}}var Rr=function(r){if(!r)return null;for(var n=[],e=r;e&&e!==document.body;)n.push({current:I(e),parent:I(e.parentElement),left:I(e.previousElementSibling),right:I(e.nextElementSibling)}),e=e.parentElement;return{element:I(r),stack:n,ownerDocument:r.ownerDocument}},Wr=function(r){var n,e,t,a,u;if(r)for(var o=r.stack,c=r.ownerDocument,m=new Map,i=0,h=o;i<h.length;i++){var f=h[i],v=(n=f.parent)===null||n===void 0?void 0:n.call(f);if(v&&c.contains(v)){for(var s=(e=f.left)===null||e===void 0?void 0:e.call(f),l=f.current(),d=v.contains(l)?l:void 0,E=(t=f.right)===null||t===void 0?void 0:t.call(f),F=R([v],m),g=(u=(a=d??(s==null?void 0:s.nextElementSibling))!==null&&a!==void 0?a:E)!==null&&u!==void 0?u:s;g;){for(var y=0,H=F;y<H.length;y++){var q=H[y];if(g!=null&&g.contains(q.node))return q.node}g=g.nextElementSibling}if(F.length)return F[0].node}}},zr=function(r){var n=Rr(r);return function(){return Wr(n)}},Br=function(r,n,e){if(!r||!n)return console.error("no element or scope given"),{};var t=x(n);if(t.every(function(o){return!O(o,r)}))return console.error("Active element is not contained in the scope"),{};var a=e?R(t,new Map):w(t,new Map),u=a.findIndex(function(o){var c=o.node;return c===r});if(u!==-1)return{prev:a[u-1],next:a[u+1],first:a[0],last:a[a.length-1]}},Lr=function(r,n){var e=n?R(x(r),new Map):w(x(r),new Map);return{first:e[0],last:e[e.length-1]}},Hr=function(r){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},r)},or=function(r,n,e){n===void 0&&(n={});var t=Hr(n),a=Br(r,t.scope,t.onlyTabbable);if(a){var u=e(a,t.cycle);u&&L(u.node,t.focusOptions)}},Kr=function(r,n){n===void 0&&(n={}),or(r,n,function(e,t){var a=e.next,u=e.first;return a||t&&u})},Yr=function(r,n){n===void 0&&(n={}),or(r,n,function(e,t){var a=e.prev,u=e.last;return a||t&&u})},ir=function(r,n,e){var t,a=Lr(r,(t=n.onlyTabbable)!==null&&t!==void 0?t:!0),u=a[e];u&&L(u.node,n.focusOptions)},Jr=function(r,n){n===void 0&&(n={}),ir(r,n,"first")},Qr=function(r,n){n===void 0&&(n={}),ir(r,n,"last")};export{fr as F,G as a,qr as b,zr as c,Kr as d,jr as e,Gr as f,w as g,Yr as h,Jr as i,Qr as j,vr as k,cr as l,Vr as m};
