import{g as L}from"./get-value-At7x-fOk.js";import{s as S}from"./set-value-CHDA_Ij2.js";function P(s){return typeof s>"u"||s===null}function d(s){return typeof s>"u"||s===null||s===""}function w(s,e,r){return e&&typeof s=="string"&&(s=s.replace(/(^\s*)|(\s*$)/g,"")),r?!P(s):Array.isArray(s)?!!s.length:!d(s)}function V(s){return Array.isArray(s)?s.join("."):s}function g(s,e){return typeof s=="string"?s.replace(/\$\{\s*(\w+)\s*\}/g,(r,t)=>d(e==null?void 0:e[t])?`\${${t}}`:e==null?void 0:e[t]):s}function z(s){return s!=null&&(typeof s=="object"||typeof s=="function")}function D(s){return s instanceof Promise||z(s)&&typeof s.then=="function"}function v(s,e,r){return(t,n)=>{for(let i=0;i<n.length;i+=1){const{onValid:u,errorMessage:a,params:o,isAsync:l}=n[i];if(l)continue;const h=u(t,s,e),c=typeof a=="function"?a():a;if(h===!1)return{hasError:!0,errorMessage:g(c,{...o,name:r||(Array.isArray(e)?e.join("."):e)})};if(D(h))throw new Error('synchronous validator had an async result, you should probably call "checkAsync()"');if(typeof h=="object"&&(h.hasError||h.array))return h}return null}}function M(s,e,r){function t(n){return i=>i===!1?{hasError:!0,errorMessage:n}:typeof i=="object"&&(i.hasError||i.array)?i:null}return(n,i)=>{const u=i.map(a=>{const{onValid:o,errorMessage:l,params:h}=a,c=typeof l=="function"?l():l;return Promise.resolve(o(n,s,e)).then(t(g(c,{...h,name:r||V(e)})))});return Promise.all(u).then(a=>a.find(o=>o&&(o==null?void 0:o.hasError)))}}const _=Object.prototype.hasOwnProperty;function A(s,e){return s===e?s!==0||e!==0||1/s===1/e:s!==s&&e!==e}function C(s,e){if(A(s,e))return!0;if(typeof s!="object"||s===null||typeof e!="object"||e===null)return!1;const r=Object.keys(s),t=Object.keys(e);if(r.length!==t.length)return!1;for(let n=0;n<r.length;n+=1)if(!_.call(e,r[n])||!A(s[r[n]],e[r[n]]))return!1;return!0}function q(s){return s.split(".").length===1?s:s.split(".").map((r,t)=>t===0?r:/^\d+$/.test(r)?`array.${r}`:`object.${r}`).join(".")}const j={mixed:{isRequired:"${name} is a required field",isRequiredOrEmpty:"${name} is a required field",equalTo:"${name} must be the same as ${toFieldName}"},array:{type:"${name} must be an array",rangeLength:"${name} must contain ${minLength} to ${maxLength} items",minLength:"${name} field must have at least ${minLength} items",maxLength:"${name} field must have less than or equal to ${maxLength} items",unrepeatable:"${name} must have non-repeatable items"},boolean:{type:"${name} must be a boolean"},date:{type:"${name} must be a date",min:"${name} field must be later than ${min}",max:"${name} field must be at earlier than ${max}",range:"${name} field must be between ${min} and ${max}"},number:{type:"${name} must be a number",isInteger:"${name} must be an integer",pattern:"${name} is invalid",isOneOf:"${name} must be one of the following values: ${values}",range:"${name} field must be between ${min} and ${max}",min:"${name} must be greater than or equal to ${min}",max:"${name} must be less than or equal to ${max}"},string:{type:"${name} must be a string",containsLetter:"${name} field must contain letters",containsUppercaseLetter:"${name} must be a upper case string",containsLowercaseLetter:"${name} must be a lowercase string",containsLetterOnly:"${name} must all be letters",containsNumber:"${name} field must contain numbers",isOneOf:"${name} must be one of the following values: ${values}",isEmail:"${name} must be a valid email",isURL:"${name} must be a valid URL",isHex:"${name} must be a valid hexadecimal",pattern:"${name} is invalid",rangeLength:"${name} must contain ${minLength} to ${maxLength} characters",minLength:"${name} must be at least ${minLength} characters",maxLength:"${name} must be at most ${maxLength} characters"},object:{type:"${name} must be an object"}},$="objectTypeSchemaSpec";function x(s,e,r){if(r){const t=e.split(".").join(`.${$}.`);return L(s,t)}return s==null?void 0:s[e]}function k(s,e,r){return r?L(s,e):s==null?void 0:s[e]}class y{constructor(e){this.required=!1,this.requiredMessage="",this.trim=!1,this.emptyAllowed=!1,this.rules=[],this.priorityRules=[],this.otherFields=[],this.proxyOptions={},this.$typeName=e,this.locale=Object.assign(e?j[e]:{},j.mixed)}setSchemaOptions(e,r){this.$schemaSpec=e,this.value=r}check(e=this.value,r,t){if(this.required&&!w(e,this.trim,this.emptyAllowed))return{hasError:!0,errorMessage:g(this.requiredMessage,{name:this.fieldLabel||V(t)})};const n=v(r,t,this.fieldLabel),i=n(e,this.priorityRules);return i||(!this.required&&d(e)?{hasError:!1}:n(e,this.rules)||{hasError:!1})}checkAsync(e=this.value,r,t){if(this.required&&!w(e,this.trim,this.emptyAllowed))return Promise.resolve({hasError:!0,errorMessage:g(this.requiredMessage,{name:this.fieldLabel||V(t)})});const n=M(r,t,this.fieldLabel);return new Promise(i=>n(e,this.priorityRules).then(u=>{u&&i(u)}).then(()=>{!this.required&&d(e)&&i({hasError:!1})}).then(()=>n(e,this.rules)).then(u=>{u&&i(u),i({hasError:!1})}))}pushRule(e){var r,t;const{onValid:n,errorMessage:i,priority:u,params:a}=e,o={onValid:n,params:a,isAsync:e.isAsync,errorMessage:i||((t=(r=this.rules)===null||r===void 0?void 0:r[0])===null||t===void 0?void 0:t.errorMessage)};u?this.priorityRules.push(o):this.rules.push(o)}addRule(e,r,t){return this.pushRule({onValid:e,errorMessage:r,priority:t}),this}addAsyncRule(e,r,t){return this.pushRule({onValid:e,isAsync:!0,errorMessage:r,priority:t}),this}isRequired(e=this.locale.isRequired,r=!0){return this.required=!0,this.trim=r,this.requiredMessage=e,this}isRequiredOrEmpty(e=this.locale.isRequiredOrEmpty,r=!0){return this.required=!0,this.trim=r,this.emptyAllowed=!0,this.requiredMessage=e,this}when(e){return this.addRule((r,t,n)=>e(this.$schemaSpec).check(r,t,n),void 0,!0),this}equalTo(e,r=this.locale.equalTo){const t=()=>{const n=x(this.$schemaSpec,e,!0);return g(r,{toFieldName:(n==null?void 0:n.fieldLabel)||e})};return this.addRule((n,i)=>C(n,L(i,e)),t),this}proxy(e,r){return this.otherFields=e,this.proxyOptions=r||{},this}label(e){return this.fieldLabel=e,this}}function X(){return new y}class F{constructor(e){this.checkResult={},this.$spec=e}getFieldType(e,r){return x(this.$spec,e,r)}setFieldCheckResult(e,r,t){if(t){const n=e.split(".").join(".object.");S(this.checkResult,n,r);return}this.checkResult[e]=r}setSchemaOptionsForAllType(e){e!==this.data&&(Object.entries(this.$spec).forEach(([r,t])=>{t.setSchemaOptions(this.$spec,e==null?void 0:e[r])}),this.data=e)}getCheckResult(e,r=this.checkResult){return e?(r==null?void 0:r[e])||L(r,q(e))||{hasError:!1}:r}getErrorMessages(e,r=this.checkResult){let t=[];if(e){const{errorMessage:n,object:i,array:u}=(r==null?void 0:r[e])||L(r,q(e))||{};n?t=[n]:i?t=Object.keys(i).map(a=>{var o;return(o=i[a])===null||o===void 0?void 0:o.errorMessage}):u&&(t=u.map(a=>a==null?void 0:a.errorMessage))}else t=Object.keys(r).map(n=>{var i;return(i=r[n])===null||i===void 0?void 0:i.errorMessage});return t.filter(Boolean)}getKeys(){return Object.keys(this.$spec)}getSchemaSpec(){return this.$spec}checkForField(e,r,t={}){var n;this.setSchemaOptionsForAllType(r);const{nestedObject:i}=t,u=this.getFieldType(e,i);if(!u)return{hasError:!1};const a=k(r,e,i),o=u.check(a,r,e);if(this.setFieldCheckResult(e,o,i),!o.hasError){const{checkIfValueExists:l}=u.proxyOptions;(n=u.otherFields)===null||n===void 0||n.forEach(h=>{if(l){d(k(r,h,i))||this.checkForField(h,r,t);return}this.checkForField(h,r,t)})}return o}checkForFieldAsync(e,r,t={}){this.setSchemaOptionsForAllType(r);const{nestedObject:n}=t,i=this.getFieldType(e,n);if(!i)return Promise.resolve({hasError:!1});const u=k(r,e,n);return i.checkAsync(u,r,e).then(async o=>{var l;if(this.setFieldCheckResult(e,o,n),!o.hasError){const{checkIfValueExists:h}=i.proxyOptions,c=[];(l=i.otherFields)===null||l===void 0||l.forEach(f=>{if(h){d(k(r,f,n))||c.push(this.checkForFieldAsync(f,r,t));return}c.push(this.checkForFieldAsync(f,r,t))}),await Promise.all(c)}return o})}check(e){const r={};return Object.keys(this.$spec).forEach(t=>{typeof e=="object"&&(r[t]=this.checkForField(t,e))}),r}checkAsync(e){const r={},t=[],n=[];return Object.keys(this.$spec).forEach(i=>{n.push(i),t.push(this.checkForFieldAsync(i,e))}),Promise.all(t).then(i=>{for(let u=0;u<i.length;u+=1)r[n[u]]=i[u];return r})}}function U(s){return new F(s)}U.combine=function(...e){return new F(e.map(r=>r.$spec).reduce((r,t)=>Object.assign(r,t),{}))};class I extends y{constructor(e){super("string"),super.pushRule({onValid:r=>typeof r=="string",errorMessage:e||this.locale.type})}containsLetter(e=this.locale.containsLetter){return super.pushRule({onValid:r=>/[a-zA-Z]/.test(r),errorMessage:e}),this}containsUppercaseLetter(e=this.locale.containsUppercaseLetter){return super.pushRule({onValid:r=>/[A-Z]/.test(r),errorMessage:e}),this}containsLowercaseLetter(e=this.locale.containsLowercaseLetter){return super.pushRule({onValid:r=>/[a-z]/.test(r),errorMessage:e}),this}containsLetterOnly(e=this.locale.containsLetterOnly){return super.pushRule({onValid:r=>/^[a-zA-Z]+$/.test(r),errorMessage:e}),this}containsNumber(e=this.locale.containsNumber){return super.pushRule({onValid:r=>/[0-9]/.test(r),errorMessage:e}),this}isOneOf(e,r=this.locale.isOneOf){return super.pushRule({onValid:t=>!!~e.indexOf(t),errorMessage:r,params:{values:e}}),this}isEmail(e=this.locale.isEmail){const r=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return super.pushRule({onValid:t=>r.test(t),errorMessage:e}),this}isURL(e=this.locale.isURL,r){var t;const n=new RegExp((t=r==null?void 0:r.allowMailto)!==null&&t!==void 0&&t?"^(?:mailto:|(?:(?:http|https|ftp)://|//))(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$":"^(?!mailto:)(?:(?:http|https|ftp)://|//)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$","i");return super.pushRule({onValid:i=>n.test(i),errorMessage:e}),this}isHex(e=this.locale.isHex){const r=/^#?([a-f0-9]{6}|[a-f0-9]{3})$/i;return super.pushRule({onValid:t=>r.test(t),errorMessage:e}),this}pattern(e,r=this.locale.pattern){return super.pushRule({onValid:t=>e.test(t),errorMessage:r,params:{regexp:e}}),this}rangeLength(e,r,t=this.locale.rangeLength){return super.pushRule({onValid:n=>n.length>=e&&n.length<=r,errorMessage:t,params:{minLength:e,maxLength:r}}),this}minLength(e,r=this.locale.minLength){return super.pushRule({onValid:t=>Array.from(t).length>=e,errorMessage:r,params:{minLength:e}}),this}maxLength(e,r=this.locale.maxLength){return super.pushRule({onValid:t=>Array.from(t).length<=e,errorMessage:r,params:{maxLength:e}}),this}}function Y(s){return new I(s)}function E(s){return+s}class Z extends y{constructor(e){super("number"),super.pushRule({onValid:r=>/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(r+""),errorMessage:e||this.locale.type})}isInteger(e=this.locale.isInteger){return super.pushRule({onValid:r=>/^-?\d+$/.test(r+""),errorMessage:e}),this}pattern(e,r=this.locale.pattern){return super.pushRule({onValid:t=>e.test(t+""),errorMessage:r,params:{regexp:e}}),this}isOneOf(e,r=this.locale.isOneOf){return super.pushRule({onValid:t=>e.includes(E(t)),errorMessage:r,params:{values:e}}),this}range(e,r,t=this.locale.range){return super.pushRule({onValid:n=>E(n)>=e&&E(n)<=r,errorMessage:t,params:{min:e,max:r}}),this}min(e,r=this.locale.min){return super.pushRule({onValid:t=>E(t)>=e,errorMessage:r,params:{min:e}}),this}max(e,r=this.locale.max){return super.pushRule({onValid:t=>E(t)<=e,errorMessage:r,params:{max:e}}),this}}function B(s){return new Z(s)}class H extends y{constructor(e){super("array"),super.pushRule({onValid:r=>Array.isArray(r),errorMessage:e||this.locale.type})}rangeLength(e,r,t=this.locale.rangeLength){return super.pushRule({onValid:n=>n.length>=e&&n.length<=r,errorMessage:t,params:{minLength:e,maxLength:r}}),this}minLength(e,r=this.locale.minLength){return super.pushRule({onValid:t=>t.length>=e,errorMessage:r,params:{minLength:e}}),this}maxLength(e,r=this.locale.maxLength){return super.pushRule({onValid:t=>t.length<=e,errorMessage:r,params:{maxLength:e}}),this}unrepeatable(e=this.locale.unrepeatable){return super.pushRule({onValid:r=>{const t={};for(const n in r){if(t[r[n]])return!1;t[r[n]]=!0}return!0},errorMessage:e}),this}of(e){return super.pushRule({onValid:(r,t,n)=>{const i=r.map((a,o)=>{const l=Array.isArray(n)?[...n,`[${o}]`]:[n,`[${o}]`];return e.check(a,t,l)});return{hasError:!!i.find(a=>a==null?void 0:a.hasError),array:i}}}),this}}function N(s){return new H(s)}class G extends y{constructor(e){super("date"),super.pushRule({onValid:r=>!/Invalid|NaN/.test(new Date(r).toString()),errorMessage:e||this.locale.type})}range(e,r,t=this.locale.range){return super.pushRule({onValid:n=>new Date(n)>=new Date(e)&&new Date(n)<=new Date(r),errorMessage:t,params:{min:e,max:r}}),this}min(e,r=this.locale.min){return super.pushRule({onValid:t=>new Date(t)>=new Date(e),errorMessage:r,params:{min:e}}),this}max(e,r=this.locale.max){return super.pushRule({onValid:t=>new Date(t)<=new Date(e),errorMessage:r,params:{max:e}}),this}}function ee(s){return new G(s)}class J extends y{constructor(e){super("object"),super.pushRule({onValid:r=>typeof r=="object",errorMessage:e||this.locale.type})}check(e=this.value,r,t){const n=(i,u,a,o)=>{var l;if(a.required&&!w(i,a.trim,a.emptyAllowed))return{hasError:!0,errorMessage:g(a.requiredMessage||((l=a.locale)===null||l===void 0?void 0:l.isRequired),{name:a.fieldLabel||o||t})};if(a[$]&&typeof i=="object"){const f={};let R=!1;return Object.entries(a[$]).forEach(([b,m])=>{const p=n(i[b],i,m,b);p!=null&&p.hasError&&(R=!0),f[b]=p}),{hasError:R,object:f}}const h=v(u,o||t,a.fieldLabel),c=h(i,a.priorityRules);return c||(!a.required&&d(i)?{hasError:!1}:h(i,a.rules)||{hasError:!1})};return n(e,r,this)}checkAsync(e=this.value,r,t){const n=(i,u,a,o)=>{var l;if(a.required&&!w(i,a.trim,a.emptyAllowed))return Promise.resolve({hasError:!0,errorMessage:g(a.requiredMessage||((l=a.locale)===null||l===void 0?void 0:l.isRequired),{name:a.fieldLabel||o||t})});const h=M(u,o||t,a.fieldLabel);return new Promise(c=>{if(a[$]&&typeof i=="object"){const f={},R=[],b=[];return Object.entries(a[$]).forEach(([m,p])=>{R.push(n(i[m],i,p,m)),b.push(m)}),Promise.all(R).then(m=>{let p=!1;m.forEach((O,T)=>{O!=null&&O.hasError&&(p=!0),f[b[T]]=O}),c({hasError:p,object:f})})}return h(i,a.priorityRules).then(f=>{f&&c(f)}).then(()=>{!a.required&&d(i)&&c({hasError:!1})}).then(()=>h(i,a.rules)).then(f=>{f&&c(f),c({hasError:!1})})})};return n(e,r,this)}shape(e){return this[$]=e,this}}function re(s){return new J(s)}class K extends y{constructor(e){super("boolean"),super.pushRule({onValid:r=>typeof r=="boolean",errorMessage:e||this.locale.type})}}function te(s){return new K(s)}export{U as S,Y as a,B as b,N as c,ee as d,te as e,X as f,re as g};
